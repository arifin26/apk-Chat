{"dependencies":[{"name":"../flow_interfaces","data":{"isAsync":false}},{"name":"../constants/operations","data":{"isAsync":false}},{"name":"../utils","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.getOperation = getOperation;\n  exports.validateParams = validateParams;\n  exports.getURL = getURL;\n  exports.getRequestTimeout = getRequestTimeout;\n  exports.isAuthSupported = isAuthSupported;\n  exports.prepareParams = prepareParams;\n  exports.handleResponse = handleResponse;\n\n  var _flow_interfaces = _$$_REQUIRE(_dependencyMap[0], \"../flow_interfaces\");\n\n  var _operations = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[1], \"../constants/operations\"));\n\n  var _utils = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[2], \"../utils\"));\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : {\n      \"default\": obj\n    };\n  }\n\n  function __processMessage(modules, message) {\n    var config = modules.config,\n        crypto = modules.crypto;\n    if (!config.cipherKey) return message;\n\n    try {\n      return crypto.decrypt(message);\n    } catch (e) {\n      return message;\n    }\n  }\n\n  function getOperation() {\n    return _operations[\"default\"].PNFetchMessagesOperation;\n  }\n\n  function validateParams(modules, incomingParams) {\n    var channels = incomingParams.channels,\n        _incomingParams$inclu = incomingParams.includeMessageActions,\n        includeMessageActions = _incomingParams$inclu === void 0 ? false : _incomingParams$inclu;\n    var config = modules.config;\n    if (!channels || channels.length === 0) return 'Missing channels';\n    if (!config.subscribeKey) return 'Missing Subscribe Key';\n\n    if (includeMessageActions && channels.length > 1) {\n      throw new TypeError('History can return actions data for a single channel only. Either pass a single channel or disable the includeMessageActions flag.');\n    }\n  }\n\n  function getURL(modules, incomingParams) {\n    var _incomingParams$chann = incomingParams.channels,\n        channels = _incomingParams$chann === void 0 ? [] : _incomingParams$chann,\n        _incomingParams$inclu2 = incomingParams.includeMessageActions,\n        includeMessageActions = _incomingParams$inclu2 === void 0 ? false : _incomingParams$inclu2;\n    var config = modules.config;\n    var endpoint = !includeMessageActions ? 'history' : 'history-with-actions';\n    var stringifiedChannels = channels.length > 0 ? channels.join(',') : ',';\n    return \"/v3/\".concat(endpoint, \"/sub-key/\").concat(config.subscribeKey, \"/channel/\").concat(_utils[\"default\"].encodeString(stringifiedChannels));\n  }\n\n  function getRequestTimeout(_ref) {\n    var config = _ref.config;\n    return config.getTransactionTimeout();\n  }\n\n  function isAuthSupported() {\n    return true;\n  }\n\n  function prepareParams(modules, incomingParams) {\n    var start = incomingParams.start,\n        end = incomingParams.end,\n        count = incomingParams.count,\n        _incomingParams$strin = incomingParams.stringifiedTimeToken,\n        stringifiedTimeToken = _incomingParams$strin === void 0 ? false : _incomingParams$strin,\n        _incomingParams$inclu3 = incomingParams.includeMeta,\n        includeMeta = _incomingParams$inclu3 === void 0 ? false : _incomingParams$inclu3;\n    var outgoingParams = {};\n    if (count) outgoingParams.max = count;\n    if (start) outgoingParams.start = start;\n    if (end) outgoingParams.end = end;\n    if (stringifiedTimeToken) outgoingParams.string_message_token = 'true';\n    if (includeMeta) outgoingParams.include_meta = 'true';\n    return outgoingParams;\n  }\n\n  function handleResponse(modules, serverResponse) {\n    var response = {\n      channels: {}\n    };\n    Object.keys(serverResponse.channels || {}).forEach(function (channelName) {\n      response.channels[channelName] = [];\n      (serverResponse.channels[channelName] || []).forEach(function (messageEnvelope) {\n        var announce = {};\n        announce.channel = channelName;\n        announce.subscription = null;\n        announce.timetoken = messageEnvelope.timetoken;\n        announce.message = __processMessage(modules, messageEnvelope.message);\n\n        if (messageEnvelope.actions) {\n          announce.data = messageEnvelope.actions;\n        }\n\n        if (messageEnvelope.meta) {\n          announce.meta = messageEnvelope.meta;\n        }\n\n        response.channels[channelName].push(announce);\n      });\n    });\n    return response;\n  }\n});","lineCount":119,"map":[[2,0,1,0],[4,0,3,0,"Object"],[4,2,3,0,"Object"],[4,8,3,6],[4,9,3,7,"defineProperty"],[4,23,3,0],[4,24,3,22,"exports"],[4,31,3,0],[4,33,3,31],[4,45,3,0],[4,47,3,45],[5,0,4,2,"value"],[5,4,4,2,"value"],[5,9,4,7],[5,11,4,9],[6,0,3,45],[6,3,3,0],[7,0,6,0,"exports"],[7,2,6,0,"exports"],[7,9,6,7],[7,10,6,8,"getOperation"],[7,22,6,0],[7,25,6,23,"getOperation"],[7,37,6,0],[8,0,7,0,"exports"],[8,2,7,0,"exports"],[8,9,7,7],[8,10,7,8,"validateParams"],[8,24,7,0],[8,27,7,25,"validateParams"],[8,41,7,0],[9,0,8,0,"exports"],[9,2,8,0,"exports"],[9,9,8,7],[9,10,8,8,"getURL"],[9,16,8,0],[9,19,8,17,"getURL"],[9,25,8,0],[10,0,9,0,"exports"],[10,2,9,0,"exports"],[10,9,9,7],[10,10,9,8,"getRequestTimeout"],[10,27,9,0],[10,30,9,28,"getRequestTimeout"],[10,47,9,0],[11,0,10,0,"exports"],[11,2,10,0,"exports"],[11,9,10,7],[11,10,10,8,"isAuthSupported"],[11,25,10,0],[11,28,10,26,"isAuthSupported"],[11,43,10,0],[12,0,11,0,"exports"],[12,2,11,0,"exports"],[12,9,11,7],[12,10,11,8,"prepareParams"],[12,23,11,0],[12,26,11,24,"prepareParams"],[12,39,11,0],[13,0,12,0,"exports"],[13,2,12,0,"exports"],[13,9,12,7],[13,10,12,8,"handleResponse"],[13,24,12,0],[13,27,12,25,"handleResponse"],[13,41,12,0],[15,0,14,0],[15,6,14,4,"_flow_interfaces"],[15,22,14,20],[15,25,14,23,"require"],[15,36,14,30],[15,77,14,0],[17,0,16,0],[17,6,16,4,"_operations"],[17,17,16,15],[17,20,16,18,"_interopRequireDefault"],[17,42,16,40],[17,43,16,41,"require"],[17,54,16,48],[17,100,16,40],[17,101,16,0],[19,0,18,0],[19,6,18,4,"_utils"],[19,12,18,10],[19,15,18,13,"_interopRequireDefault"],[19,37,18,35],[19,38,18,36,"require"],[19,49,18,43],[19,80,18,35],[19,81,18,0],[21,0,20,0],[21,11,20,9,"_interopRequireDefault"],[21,33,20,0],[21,34,20,32,"obj"],[21,37,20,0],[21,39,20,37],[22,0,20,39],[22,11,20,46,"obj"],[22,14,20,49],[22,18,20,53,"obj"],[22,21,20,56],[22,22,20,57,"__esModule"],[22,32,20,46],[22,35,20,70,"obj"],[22,38,20,46],[22,41,20,76],[23,0,20,78],[23,17,20,89,"obj"],[24,0,20,76],[24,5,20,39],[25,0,20,97],[27,0,22,0],[27,11,22,9,"__processMessage"],[27,27,22,0],[27,28,22,26,"modules"],[27,35,22,0],[27,37,22,35,"message"],[27,44,22,0],[27,46,22,44],[28,0,23,2],[28,8,23,6,"config"],[28,14,23,12],[28,17,23,15,"modules"],[28,24,23,22],[28,25,23,23,"config"],[28,31,23,2],[29,0,23,2],[29,8,24,6,"crypto"],[29,14,24,12],[29,17,24,15,"modules"],[29,24,24,22],[29,25,24,23,"crypto"],[29,31,23,2],[30,0,25,2],[30,8,25,6],[30,9,25,7,"config"],[30,15,25,13],[30,16,25,14,"cipherKey"],[30,25,25,2],[30,27,25,25],[30,34,25,32,"message"],[30,41,25,25],[32,0,27,2],[32,8,27,6],[33,0,28,4],[33,13,28,11,"crypto"],[33,19,28,17],[33,20,28,18,"decrypt"],[33,27,28,11],[33,28,28,26,"message"],[33,35,28,11],[33,36,28,4],[34,0,29,3],[34,5,27,2],[34,6,29,4],[34,13,29,11,"e"],[34,14,29,4],[34,16,29,14],[35,0,30,4],[35,13,30,11,"message"],[35,20,30,4],[36,0,31,3],[37,0,32,1],[39,0,34,0],[39,11,34,9,"getOperation"],[39,23,34,0],[39,26,34,24],[40,0,35,2],[40,11,35,9,"_operations"],[40,22,35,20],[40,23,35,21],[40,32,35,20],[40,33,35,9],[40,34,35,32,"PNFetchMessagesOperation"],[40,58,35,2],[41,0,36,1],[43,0,38,0],[43,11,38,9,"validateParams"],[43,25,38,0],[43,26,38,24,"modules"],[43,33,38,0],[43,35,38,33,"incomingParams"],[43,49,38,0],[43,51,38,49],[44,0,39,2],[44,8,39,6,"channels"],[44,16,39,14],[44,19,39,17,"incomingParams"],[44,33,39,31],[44,34,39,32,"channels"],[44,42,39,2],[45,0,39,2],[45,8,40,6,"_incomingParams$inclu"],[45,29,40,27],[45,32,40,30,"incomingParams"],[45,46,40,44],[45,47,40,45,"includeMessageActions"],[45,68,39,2],[46,0,39,2],[46,8,41,6,"includeMessageActions"],[46,29,41,27],[46,32,41,30,"_incomingParams$inclu"],[46,53,41,51],[46,58,41,56],[46,63,41,61],[46,64,41,30],[46,67,41,65],[46,72,41,30],[46,75,41,73,"_incomingParams$inclu"],[46,96,39,2],[47,0,42,2],[47,8,42,6,"config"],[47,14,42,12],[47,17,42,15,"modules"],[47,24,42,22],[47,25,42,23,"config"],[47,31,42,2],[48,0,43,2],[48,8,43,6],[48,9,43,7,"channels"],[48,17,43,6],[48,21,43,19,"channels"],[48,29,43,27],[48,30,43,28,"length"],[48,36,43,19],[48,41,43,39],[48,42,43,2],[48,44,43,42],[48,51,43,49],[48,69,43,42],[49,0,44,2],[49,8,44,6],[49,9,44,7,"config"],[49,15,44,13],[49,16,44,14,"subscribeKey"],[49,28,44,2],[49,30,44,28],[49,37,44,35],[49,60,44,28],[51,0,46,2],[51,8,46,6,"includeMessageActions"],[51,29,46,27],[51,33,46,31,"channels"],[51,41,46,39],[51,42,46,40,"length"],[51,48,46,31],[51,51,46,49],[51,52,46,2],[51,54,46,52],[52,0,47,4],[52,12,47,10],[52,16,47,14,"TypeError"],[52,25,47,10],[52,26,47,24],[52,158,47,10],[52,159,47,4],[53,0,48,3],[54,0,49,1],[56,0,51,0],[56,11,51,9,"getURL"],[56,17,51,0],[56,18,51,16,"modules"],[56,25,51,0],[56,27,51,25,"incomingParams"],[56,41,51,0],[56,43,51,41],[57,0,52,2],[57,8,52,6,"_incomingParams$chann"],[57,29,52,27],[57,32,52,30,"incomingParams"],[57,46,52,44],[57,47,52,45,"channels"],[57,55,52,2],[58,0,52,2],[58,8,53,6,"channels"],[58,16,53,14],[58,19,53,17,"_incomingParams$chann"],[58,40,53,38],[58,45,53,43],[58,50,53,48],[58,51,53,17],[58,54,53,52],[58,56,53,17],[58,59,53,57,"_incomingParams$chann"],[58,80,52,2],[59,0,52,2],[59,8,54,6,"_incomingParams$inclu2"],[59,30,54,28],[59,33,54,31,"incomingParams"],[59,47,54,45],[59,48,54,46,"includeMessageActions"],[59,69,52,2],[60,0,52,2],[60,8,55,6,"includeMessageActions"],[60,29,55,27],[60,32,55,30,"_incomingParams$inclu2"],[60,54,55,52],[60,59,55,57],[60,64,55,62],[60,65,55,30],[60,68,55,66],[60,73,55,30],[60,76,55,74,"_incomingParams$inclu2"],[60,98,52,2],[61,0,56,2],[61,8,56,6,"config"],[61,14,56,12],[61,17,56,15,"modules"],[61,24,56,22],[61,25,56,23,"config"],[61,31,56,2],[62,0,57,2],[62,8,57,6,"endpoint"],[62,16,57,14],[62,19,57,17],[62,20,57,18,"includeMessageActions"],[62,41,57,17],[62,44,57,42],[62,53,57,17],[62,56,57,54],[62,78,57,2],[63,0,58,2],[63,8,58,6,"stringifiedChannels"],[63,27,58,25],[63,30,58,28,"channels"],[63,38,58,36],[63,39,58,37,"length"],[63,45,58,28],[63,48,58,46],[63,49,58,28],[63,52,58,50,"channels"],[63,60,58,58],[63,61,58,59,"join"],[63,65,58,50],[63,66,58,64],[63,69,58,50],[63,70,58,28],[63,73,58,71],[63,76,58,2],[64,0,59,2],[64,11,59,9],[64,18,59,16,"concat"],[64,24,59,9],[64,25,59,23,"endpoint"],[64,33,59,9],[64,35,59,33],[64,46,59,9],[64,48,59,46,"concat"],[64,54,59,9],[64,55,59,53,"config"],[64,61,59,59],[64,62,59,60,"subscribeKey"],[64,74,59,9],[64,76,59,74],[64,87,59,9],[64,89,59,87,"concat"],[64,95,59,9],[64,96,59,94,"_utils"],[64,102,59,100],[64,103,59,101],[64,112,59,100],[64,113,59,94],[64,114,59,112,"encodeString"],[64,126,59,94],[64,127,59,125,"stringifiedChannels"],[64,146,59,94],[64,147,59,9],[64,148,59,2],[65,0,60,1],[67,0,62,0],[67,11,62,9,"getRequestTimeout"],[67,28,62,0],[67,29,62,27,"_ref"],[67,33,62,0],[67,35,62,33],[68,0,63,2],[68,8,63,6,"config"],[68,14,63,12],[68,17,63,15,"_ref"],[68,21,63,19],[68,22,63,20,"config"],[68,28,63,2],[69,0,64,2],[69,11,64,9,"config"],[69,17,64,15],[69,18,64,16,"getTransactionTimeout"],[69,39,64,9],[69,41,64,2],[70,0,65,1],[72,0,67,0],[72,11,67,9,"isAuthSupported"],[72,26,67,0],[72,29,67,27],[73,0,68,2],[73,11,68,9],[73,15,68,2],[74,0,69,1],[76,0,71,0],[76,11,71,9,"prepareParams"],[76,24,71,0],[76,25,71,23,"modules"],[76,32,71,0],[76,34,71,32,"incomingParams"],[76,48,71,0],[76,50,71,48],[77,0,72,2],[77,8,72,6,"start"],[77,13,72,11],[77,16,72,14,"incomingParams"],[77,30,72,28],[77,31,72,29,"start"],[77,36,72,2],[78,0,72,2],[78,8,73,6,"end"],[78,11,73,9],[78,14,73,12,"incomingParams"],[78,28,73,26],[78,29,73,27,"end"],[78,32,72,2],[79,0,72,2],[79,8,74,6,"count"],[79,13,74,11],[79,16,74,14,"incomingParams"],[79,30,74,28],[79,31,74,29,"count"],[79,36,72,2],[80,0,72,2],[80,8,75,6,"_incomingParams$strin"],[80,29,75,27],[80,32,75,30,"incomingParams"],[80,46,75,44],[80,47,75,45,"stringifiedTimeToken"],[80,67,72,2],[81,0,72,2],[81,8,76,6,"stringifiedTimeToken"],[81,28,76,26],[81,31,76,29,"_incomingParams$strin"],[81,52,76,50],[81,57,76,55],[81,62,76,60],[81,63,76,29],[81,66,76,64],[81,71,76,29],[81,74,76,72,"_incomingParams$strin"],[81,95,72,2],[82,0,72,2],[82,8,77,6,"_incomingParams$inclu3"],[82,30,77,28],[82,33,77,31,"incomingParams"],[82,47,77,45],[82,48,77,46,"includeMeta"],[82,59,72,2],[83,0,72,2],[83,8,78,6,"includeMeta"],[83,19,78,17],[83,22,78,20,"_incomingParams$inclu3"],[83,44,78,42],[83,49,78,47],[83,54,78,52],[83,55,78,20],[83,58,78,56],[83,63,78,20],[83,66,78,64,"_incomingParams$inclu3"],[83,88,72,2],[84,0,79,2],[84,8,79,6,"outgoingParams"],[84,22,79,20],[84,25,79,23],[84,27,79,2],[85,0,80,2],[85,8,80,6,"count"],[85,13,80,2],[85,15,80,13,"outgoingParams"],[85,29,80,27],[85,30,80,28,"max"],[85,33,80,13],[85,36,80,34,"count"],[85,41,80,13],[86,0,81,2],[86,8,81,6,"start"],[86,13,81,2],[86,15,81,13,"outgoingParams"],[86,29,81,27],[86,30,81,28,"start"],[86,35,81,13],[86,38,81,36,"start"],[86,43,81,13],[87,0,82,2],[87,8,82,6,"end"],[87,11,82,2],[87,13,82,11,"outgoingParams"],[87,27,82,25],[87,28,82,26,"end"],[87,31,82,11],[87,34,82,32,"end"],[87,37,82,11],[88,0,83,2],[88,8,83,6,"stringifiedTimeToken"],[88,28,83,2],[88,30,83,28,"outgoingParams"],[88,44,83,42],[88,45,83,43,"string_message_token"],[88,65,83,28],[88,68,83,66],[88,74,83,28],[89,0,84,2],[89,8,84,6,"includeMeta"],[89,19,84,2],[89,21,84,19,"outgoingParams"],[89,35,84,33],[89,36,84,34,"include_meta"],[89,48,84,19],[89,51,84,49],[89,57,84,19],[90,0,85,2],[90,11,85,9,"outgoingParams"],[90,25,85,2],[91,0,86,1],[93,0,88,0],[93,11,88,9,"handleResponse"],[93,25,88,0],[93,26,88,24,"modules"],[93,33,88,0],[93,35,88,33,"serverResponse"],[93,49,88,0],[93,51,88,49],[94,0,89,2],[94,8,89,6,"response"],[94,16,89,14],[94,19,89,17],[95,0,90,4,"channels"],[95,6,90,4,"channels"],[95,14,90,12],[95,16,90,14],[96,0,89,17],[96,5,89,2],[97,0,92,2,"Object"],[97,4,92,2,"Object"],[97,10,92,8],[97,11,92,9,"keys"],[97,15,92,2],[97,16,92,14,"serverResponse"],[97,30,92,28],[97,31,92,29,"channels"],[97,39,92,14],[97,43,92,41],[97,45,92,2],[97,47,92,45,"forEach"],[97,54,92,2],[97,55,92,53],[97,65,92,63,"channelName"],[97,76,92,53],[97,78,92,76],[98,0,93,4,"response"],[98,6,93,4,"response"],[98,14,93,12],[98,15,93,13,"channels"],[98,23,93,4],[98,24,93,22,"channelName"],[98,35,93,4],[98,39,93,37],[98,41,93,4],[99,0,94,4],[99,7,94,5,"serverResponse"],[99,21,94,19],[99,22,94,20,"channels"],[99,30,94,5],[99,31,94,29,"channelName"],[99,42,94,5],[99,47,94,45],[99,49,94,4],[99,51,94,49,"forEach"],[99,58,94,4],[99,59,94,57],[99,69,94,67,"messageEnvelope"],[99,84,94,57],[99,86,94,84],[100,0,95,6],[100,12,95,10,"announce"],[100,20,95,18],[100,23,95,21],[100,25,95,6],[101,0,96,6,"announce"],[101,8,96,6,"announce"],[101,16,96,14],[101,17,96,15,"channel"],[101,24,96,6],[101,27,96,25,"channelName"],[101,38,96,6],[102,0,97,6,"announce"],[102,8,97,6,"announce"],[102,16,97,14],[102,17,97,15,"subscription"],[102,29,97,6],[102,32,97,30],[102,36,97,6],[103,0,98,6,"announce"],[103,8,98,6,"announce"],[103,16,98,14],[103,17,98,15,"timetoken"],[103,26,98,6],[103,29,98,27,"messageEnvelope"],[103,44,98,42],[103,45,98,43,"timetoken"],[103,54,98,6],[104,0,99,6,"announce"],[104,8,99,6,"announce"],[104,16,99,14],[104,17,99,15,"message"],[104,24,99,6],[104,27,99,25,"__processMessage"],[104,43,99,41],[104,44,99,42,"modules"],[104,51,99,41],[104,53,99,51,"messageEnvelope"],[104,68,99,66],[104,69,99,67,"message"],[104,76,99,41],[104,77,99,6],[106,0,101,6],[106,12,101,10,"messageEnvelope"],[106,27,101,25],[106,28,101,26,"actions"],[106,35,101,6],[106,37,101,35],[107,0,102,8,"announce"],[107,10,102,8,"announce"],[107,18,102,16],[107,19,102,17,"data"],[107,23,102,8],[107,26,102,24,"messageEnvelope"],[107,41,102,39],[107,42,102,40,"actions"],[107,49,102,8],[108,0,103,7],[110,0,105,6],[110,12,105,10,"messageEnvelope"],[110,27,105,25],[110,28,105,26,"meta"],[110,32,105,6],[110,34,105,32],[111,0,106,8,"announce"],[111,10,106,8,"announce"],[111,18,106,16],[111,19,106,17,"meta"],[111,23,106,8],[111,26,106,24,"messageEnvelope"],[111,41,106,39],[111,42,106,40,"meta"],[111,46,106,8],[112,0,107,7],[114,0,109,6,"response"],[114,8,109,6,"response"],[114,16,109,14],[114,17,109,15,"channels"],[114,25,109,6],[114,26,109,24,"channelName"],[114,37,109,6],[114,39,109,37,"push"],[114,43,109,6],[114,44,109,42,"announce"],[114,52,109,6],[115,0,110,5],[115,7,94,4],[116,0,111,3],[116,5,92,2],[117,0,112,2],[117,11,112,9,"response"],[117,19,112,2],[118,0,113,1]],"functionMap":{"names":["<global>","_interopRequireDefault","__processMessage","getOperation","validateParams","getURL","getRequestTimeout","isAuthSupported","prepareParams","handleResponse","Object.keys.forEach$argument_0","forEach$argument_0"],"mappings":"AAA;ACmB,iGD;AEE;CFU;AGE;CHE;AIE;CJW;AKE;CLS;AME;CNG;AOE;CPE;AQE;CRe;ASE;qDCI;yDCE;KDgB;GDC;CTE"}},"type":"js/module"}]}